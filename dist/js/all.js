"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var restaurants,neighborhoods,cuisines,restaurant,map,DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(t){fetch(o.DATABASE_URL).then(function(e){return e.json()}).then(function(e){var n=e;return console.log(t(null,n)),t(null,n)})}},{key:"fetchRestaurantById",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.find(function(e){return e.id==r});t?a(null,t):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.filter(function(e){return e.cuisine_type==r});a(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n.filter(function(e){return e.neighborhood==r});a(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,i){o.fetchRestaurants(function(e,n){if(e)i(e,null);else{var t=n;"all"!=r&&(t=t.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(t=t.filter(function(e){return e.neighborhood==a})),i(null,t)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.map(function(e,n){return t[n].neighborhood}),n=r.filter(function(e,n){return r.indexOf(e)==n});a(null,n)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.map(function(e,n){return t[n].cuisine_type}),n=r.filter(function(e,n){return r.indexOf(e)==n});a(null,n)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph)}},{key:"mapMarkerForRestaurant",value:function(e,n){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:n,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337,"/restaurants")}}]),o}(),markers=[];document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,n){e?console.error(e):(self.neighborhoods=n,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,t=document.getElementById("neighborhoods-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,n.setAttribute("aria-label",e),t.append(n)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,n){e?console.error(e):(self.cuisines=n,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,t=document.getElementById("cuisines-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),n=document.getElementById("neighborhoods-select"),t=e.selectedIndex,r=n.selectedIndex,a=e[t].value,i=n[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,i,function(e,n){e?console.error(e):(resetRestaurants(n),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,n=document.getElementById("restaurants-list");e.forEach(function(e){n.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var n=document.createElement("li"),t=document.createElement("img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt="photo of "+e.name,t.srcset="/images/".concat(e.id,"-300.jpg 300w"),n.append(t);var r=document.createElement("h3");r.innerHTML=e.name,n.append(r);var a=document.createElement("p");a.innerHTML=e.neighborhood,n.append(a);var i=document.createElement("p");i.innerHTML=e.address,n.append(i);var o=document.createElement("a");return o.innerHTML="View Details",o.href=DBHelper.urlForRestaurant(e),o.setAttribute("aria-label","Learn more about ".concat(e.name)),n.append(o),n},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var n=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(n,"click",function(){window.location.href=n.url}),self.markers.push(n)})},"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(){console.log("Service Worker Registered")}),window.initMap=function(){fetchRestaurantFromURL(function(e,n){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:n.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(t){if(self.restaurant)t(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,n){(self.restaurant=n)?(fillRestaurantHTML(),t(null,n)):console.error(e)}):(error="No restaurant id in URL",t(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.src=DBHelper.imageUrlForRestaurant(e),n.alt="photo of the "+e.name,n.srcset="/images/".concat(e.id,"-300.jpg 600w, /images/").concat(e.id,"-800.jpg 600w"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,n=document.getElementById("restaurant-hours");for(var t in n.setAttribute("role","restaurant hours"),n.setAttribute("aria-label","Restaurant Hours"),e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=t,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[t],r.appendChild(i),n.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,n=document.getElementById("reviews-container"),t=document.createElement("h2");if(t.innerHTML="Reviews",n.appendChild(t),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void n.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),n.appendChild(a)},createReviewHTML=function(e){var n=document.createElement("li");n.classList.add("review");var t=document.createElement("div");t.classList.add("review-heading"),n.appendChild(t);var r=document.createElement("p");r.innerHTML=e.name,r.classList.add("review-name"),t.appendChild(r);var a=document.createElement("p");a.innerHTML=e.date,a.classList.add("review-date"),t.appendChild(a);var i=document.createElement("p");i.innerHTML="RATING: ".concat(e.rating),i.classList.add("review-rating"),n.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,o.classList.add("review-comments"),n.appendChild(o),n},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,n=document.getElementById("breadcrumb"),t=document.createElement("li");document.createElement("a");t.innerHTML=e.name,n.appendChild(t),t.setAttribute("aria-current",e.name)},getParameterByName=function(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJyZXN0YXVyYW50X2luZm8uanMiLCJkYmhlbHBlci5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50cyIsIm5laWdoYm9yaG9vZHMiLCJjdWlzaW5lcyIsInJlc3RhdXJhbnQiLCJtYXAiLCJEQkhlbHBlciIsImNhbGxiYWNrIiwiZmV0Y2giLCJEQVRBQkFTRV9VUkwiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwidW5pcXVlQ3Vpc2luZXMiLCJjb25jYXQiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJtYXJrZXJzIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsInNldEF0dHJpYnV0ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJ3aW5kb3ciLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFsdCIsInNyY3NldCIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJmaWxsQnJlYWRjcnVtYiIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImNsYXNzTGlzdCIsImFkZCIsImRpdiIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6InVaQUFJQSxZQUNBQyxjQUNBQyxTQ0ZBQyxXQUNBQyxJQ0VFQyw0SEFtQnNCQyxHQUVwQkMsTUFBTUYsRUFBU0csY0FDVkMsS0FBSyxTQUFBQyxHQUNILE9BQU9BLEVBQVND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QVVDLElBQUksbUJBQ3ZCdkMsRUFBRytCLFlBQVlZLEdBRVIzQyxHQU1YbUIsZUFBaUIsV0FBa0MsSUFBakN2RyxFQUFpQyxFQUFBaUQsVUFBQUMsYUFBQUMsSUFBQUYsVUFBQSxHQUFBQSxVQUFBLEdBQXBCRixLQUFLL0MsV0FDMUJnSSxFQUFhdEYsU0FBU1csZUFBZSxjQUNyQytCLEVBQUsxQyxTQUFTYyxjQUFjLE1BQ3hCZCxTQUFTYyxjQUFjLEtBQ2pDNEIsRUFBRzNCLFVBQVl6RCxFQUFXbUMsS0FDMUI2RixFQUFXYixZQUFZL0IsR0FDdkJBLEVBQUd6QixhQUFhLGVBQWdCM0QsRUFBV21DLE9BTS9DcUUsbUJBQXFCLFNBQUNyRSxFQUFNQyxHQUNuQkEsSUFDREEsRUFBTTBCLE9BQU9tQyxTQUFTSixNQUMxQjFELEVBQU9BLEVBQUs4RixRQUFRLFVBQVcsUUFDL0IsSUFDSS9HLEVBRFUsSUFBSWdILE9BQUosT0FBQXZHLE9BQWtCUSxFQUFsQixzQkFDTWdHLEtBQUsvRixHQUN6QixPQUFLbEIsRUFFQUEsRUFBUSxHQUVOa0gsbUJBQW1CbEgsRUFBUSxHQUFHK0csUUFBUSxNQUFPLE1BRHpDLEdBRkEiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRzLFxyXG4gICAgbmVpZ2hib3Job29kcyxcclxuICAgIGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gICAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgICBmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICAgIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgICAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICAgIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBuZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICAgIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICAgIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgICAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gICAgbGV0IGxvYyA9IHtcclxuICAgICAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgICAgICBsbmc6IC03My45ODc1MDFcclxuICAgIH07XHJcbiAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICAgICAgem9vbTogMTIsXHJcbiAgICAgICAgY2VudGVyOiBsb2MsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICB9KTtcclxuICAgIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn1cclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICAgIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gICAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gICAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICAgIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAgIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICAgIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICAgIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICAgIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gICAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICAgIH0pO1xyXG4gICAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gICAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gICAgaW1hZ2UuYWx0ID0gJ3Bob3RvIG9mICcgKyByZXN0YXVyYW50Lm5hbWU7XHJcbiAgICBpbWFnZS5zcmNzZXQgPSBgL2ltYWdlcy8ke3Jlc3RhdXJhbnQuaWR9LTMwMC5qcGcgMzAwd2BcclxuICAgIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcbiAgICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICAgIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XHJcbiAgICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gICAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XHJcbiAgICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gICAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgTGVhcm4gbW9yZSBhYm91dCAke3Jlc3RhdXJhbnQubmFtZX1gKVxyXG4gICAgbGkuYXBwZW5kKG1vcmUpXHJcblxyXG4gICAgcmV0dXJuIGxpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgICAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5pZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJykudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZSBXb3JrZXIgUmVnaXN0ZXJlZCcpXHJcbiAgICB9KVxyXG59IiwibGV0IHJlc3RhdXJhbnQ7XG52YXIgbWFwO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gICAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICAgICAgICAgIHpvb206IDE2LFxuICAgICAgICAgICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICAgICAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICAgICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gICAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICAgIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICAgICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICAgIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gICAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICAgIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcbiAgICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gICAgaW1hZ2UuYWx0ID0gJ3Bob3RvIG9mIHRoZSAnICsgcmVzdGF1cmFudC5uYW1lO1xuICAgIGltYWdlLnNyY3NldCA9IGAvaW1hZ2VzLyR7cmVzdGF1cmFudC5pZH0tMzAwLmpwZyA2MDB3LCAvaW1hZ2VzLyR7cmVzdGF1cmFudC5pZH0tODAwLmpwZyA2MDB3YFxuXG4gICAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gICAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgICB9XG4gICAgLy8gZmlsbCByZXZpZXdzXG4gICAgZmlsbFJldmlld3NIVE1MKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gICAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICAgIGhvdXJzLnNldEF0dHJpYnV0ZSgncm9sZScsICdyZXN0YXVyYW50IGhvdXJzJyk7XG4gICAgaG91cnMuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1Jlc3RhdXJhbnQgSG91cnMnKVxuICAgIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgICAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgICBpZiAoIXJldmlld3MpIHtcbiAgICAgICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICAgIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgICAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICAgIH0pO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgIGxpLmNsYXNzTGlzdC5hZGQoJ3JldmlldycpXG5cbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIGRpdi5jbGFzc0xpc3QuYWRkKCdyZXZpZXctaGVhZGluZycpXG5cbiAgICBsaS5hcHBlbmRDaGlsZChkaXYpXG4gICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICAgIG5hbWUuY2xhc3NMaXN0LmFkZCgncmV2aWV3LW5hbWUnKTtcbiAgICBkaXYuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGRhdGUuaW5uZXJIVE1MID0gcmV2aWV3LmRhdGU7XG4gICAgZGF0ZS5jbGFzc0xpc3QuYWRkKCdyZXZpZXctZGF0ZScpO1xuICAgIGRpdi5hcHBlbmRDaGlsZChkYXRlKTtcblxuICAgIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICByYXRpbmcuaW5uZXJIVE1MID0gYFJBVElORzogJHtyZXZpZXcucmF0aW5nfWA7XG4gICAgcmF0aW5nLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1yYXRpbmcnKTtcbiAgICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gICAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICAgIGNvbW1lbnRzLmNsYXNzTGlzdC5hZGQoJ3Jldmlldy1jb21tZW50cycpXG4gICAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gICAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gICAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG4gICAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCByZXN0YXVyYW50Lm5hbWUpXG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICAgIGlmICghdXJsKVxuICAgICAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gICAgaWYgKCFyZXN1bHRzKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICBpZiAoIXJlc3VsdHNbMl0pXG4gICAgICAgIHJldHVybiAnJztcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufSIsIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIERhdGFiYXNlIFVSTC5cclxuICAgICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzdGF0aWMgaW5kZXhSZXN0YXVyYW50cygpIHtcclxuICAgIC8vICAgICBpZGIub3BlbigncmVzdGF1cmFudHMnLCAxLCAoKSA9PiB7XHJcbiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCd0aGluZ3MnKVxyXG4gICAgLy8gICAgIH0pXHJcbiAgICAvLyB9XHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuXHJcbiAgICAgICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxyXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGRhdGFcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cylcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXHJcbiAgICAgICAgICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbWFya2VyO1xyXG4gICAgfVxyXG5cclxufSJdfQ==
