importScripts("./idb.js");const dbPromise=idb.open("udacity-mws-stage-2-jc",1,e=>{e.createObjectStore("restaurants")}),idbKeyval={get:e=>dbPromise.then(t=>t.transaction("restaurants").objectStore("restaurants").get(e)),set:(e,t)=>dbPromise.then(r=>{const n=r.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(t,e),n.complete}),delete:e=>dbPromise.then(t=>{const r=t.transaction("restaurants","readwrite");return r.objectStore("restaurants").delete(e),r.complete}),clear:()=>dbPromise.then(e=>{const t=e.transaction("restaurants","readwrite");return t.objectStore("restaurants").clear(),t.complete}),keys:()=>dbPromise.then(e=>{const t=e.transaction("restaurants"),r=[],n=t.objectStore("restaurants");return(n.iterateKeyCursor||n.iterateCursor).call(n,e=>{e&&(r.push(e.key),e.continue())}),t.complete.then(()=>r)})};var CACHE_NAME="mws-stage-2",serverURL="http://127.0.0.1:1337/restaurants",urlsToCache=[serverURL];self.addEventListener("install",function(e){e.waitUntil(caches.open(CACHE_NAME).then(function(e){return console.log("opened cache"),e.addAll(["/","./index.html","./restaurant.html",serverURL])}))}),self.addEventListener("activate",function(e){console.log("[ServiceWorker] Activate"),fetch("http://127.0.0.1:1337/restaurants").then(e=>e.json()).then(e=>{console.log("we got data"),console.log(e),idbKeyval.set("restaurants",e)})}),self.addEventListener("fetch",function(e){e.respondWith(caches.match(e.request).then(function(t){return t||fetch(e.request).then(function(t){return caches.open(CACHE_NAME).then(function(r){return r.put(e.request,t.clone()),t})})}))});